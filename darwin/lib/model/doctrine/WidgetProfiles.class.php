<?php

/**
 * WidgetProfiles
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    darwin
 * @subpackage model
 * @author     DB team <darwin-ict@naturalsciences.be>
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class WidgetProfiles extends BaseWidgetProfiles
{
	
	public function initialize_widgets()
	{
		$count_widget = 0;
		$files = array(MyWidgets::getFileByRight(Users::REGISTERED_USER ),MyWidgets::getFileByRight(Users::ENCODER ),MyWidgets::getFileByRight(Users::MANAGER ),) ;
		foreach($files as $file)
		{
			if($file)
			{
				$data = new Doctrine_Parser_Yml();
				$array = $data->loadData($file);
				foreach ($array as $widget => $array_values)
				{
					if($array_values["category"]=="specimen_widget")
					{
						$pref=new WidgetProfilesDefinition();
						$pref->setProfileRef($this->getId());
						$pref->setCategory( $array_values["category"]);
						$pref->setGroupName( $array_values["group_name"]);
						$pref->setOrderBy($array_values["order_by"]);
						$pref->setColNum($array_values["col_num"]);
						$pref->setMandatory($array_values["mandatory"]);
						$pref->setVisible($array_values["visible"]);
						$pref->setOpened($array_values["opened"]);
						$pref->setIsAvailable(true);
						$pref->setAllPublic($array_values["all_public"]);
						try
						  {
							$pref->save();
							$count_widget++;
						  }
						  catch(Doctrine_Exception $ne) {}
				
					}
				}
			}
		}
		return $count_widget;
	}
	
	public function duplicate_widgets($id_source)
	{
		print($id_source);
		$count_widget = 0;
		 $q = Doctrine_Query::create()->
         from('WidgetProfilesDefinition')->
         where('profile_ref= ? ', (int)$id_source);
		$items=$q->execute();

		//$items=$q->fetchAll();
		foreach( $items as $obj)
		{
			$pref=new WidgetProfilesDefinition();
			$pref->setProfileRef($this->getId());
			$pref->setCategory( $obj->getCategory());
			$pref->setGroupName( $obj->getGroupName());
			$pref->setOrderBy($obj->getOrderBy());
			$pref->setColNum($obj->getColNum());
			$pref->setMandatory($obj->getMandatory());
			$pref->setVisible($obj->getVisible());
			$pref->setOpened($obj->getOpened());
			$pref->setIsAvailable($obj->getIsAvailable());
			$pref->setAllPublic($obj->getAllPublic());
			try
			{
				$pref->save();
				$count_widget++;
			}
			catch(Doctrine_Exception $ne) {}
		}
		return $count_widget;
	}
}
