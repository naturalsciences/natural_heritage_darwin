<?php

/**
 * ReportsTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class ReportsTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object ReportsTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('Reports');
    }

    public function getUserReport($user)
    {
      $q =  Doctrine_Query::create()
      ->from('reports r') ;
      if($user == 'all')  
        $q->innerJoin('r.Users u') 
        ->select('r.*, u.formated_name as formatedname') ;
      else
        $q->where('r.user_ref = ?',$user);
      return $q->execute() ;
    }

    public function getTaskReports()
    {
      $q = Doctrine_Query::create()
      ->from('reports r')
      ->where('r.uri is null') ;
      return $q->execute() ;
    }
    public function updateUri($id,$uri)
    {
      $q = Doctrine_Query::create()
      ->update('reports r')
      ->set('uri','?',$uri)
      ->where('r.id=?',$id) ;
      return $q->execute() ; 
    }
}
