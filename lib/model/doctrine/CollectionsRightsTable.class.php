<?php
/**
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class CollectionsRightsTable extends DarwinTable
{
  public function findCollectionsByUser($user)
  {
    $q = Doctrine_Query::create()
        ->select('collection_ref')
        ->from('CollectionsRights')
        ->andWhere('user_ref = ?', $user) ;
    return $q->execute() ;
  }

  public function getAllUserRef($collection_id = null)
  {
    $q = Doctrine_Query::create()
      ->from('CollectionsRights')
      ->andWhere('collection_ref = ?', $collection_id);
    return $q->execute() ;
  }

  public function getCollectionsByRight($user)
  {
    $result = $this->findRights($user,'CollectionsRights') ;
    $collections = array() ;
    foreach($result as $rights)
      $collections[] = $rights->getCollectionRef() ;
    return $collections ;
  }

  public function hasEditRightsFor($user,$collection_ref)
  {
    if($user->isA(Users::ADMIN))
       return true;
    $q = Doctrine_Query::create()
      ->from('CollectionsRights')
      ->andWhere('collection_ref = ?', $collection_ref)
      ->andWhere('user_ref = ?',$user->getId())
      ->andWhere('db_user_type >= 2');
      return $q->count() != 0;
  }
}
